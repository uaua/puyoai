cmake_minimum_required(VERSION 2.8)

add_library(puyoai_wii
            wii_connect_server.cc
            stdout_key_sender.cc
            serial_key_sender.cc)

function(puyoai_wii_add_executable exe)
    add_executable(${exe} ${ARGN})
    target_link_libraries(${exe} puyoai_wii)
    if(LIB_USB)
        target_link_libraries(${exe} puyoai_capture_syntek)
        target_link_libraries(${exe} puyoai_capture_driver_syntek)
    endif()
    target_link_libraries(${exe} puyoai_capture)
    target_link_libraries(${exe} puyoai_recognition)
    target_link_libraries(${exe} puyoai_core_server_connector)
    target_link_libraries(${exe} puyoai_core_server)
    target_link_libraries(${exe} puyoai_core_rensa)
    target_link_libraries(${exe} puyoai_core_plan)
    target_link_libraries(${exe} puyoai_core_rensa_tracker)
    target_link_libraries(${exe} puyoai_core)
    target_link_libraries(${exe} puyoai_gui)
    target_link_libraries(${exe} puyoai_lib_jsoncpp)
    target_link_libraries(${exe} puyoai_base)
    if(V4L2_LIBRARY)
        target_link_libraries(${exe} puyoai_capture_viddev)
    endif()
    if(USE_AUDIO_COMMENTATOR)
        target_link_libraries(${exe} puyoai_audio)
        target_link_libraries(${exe} puyoai_internal_audio_darwin)
        target_link_libraries(${exe} ${COCOA_LIBRARY})
    endif()
    puyoai_target_link_libraries(${exe})
    target_link_libraries(${exe} ${SDL2_LIBRARIES})
    target_link_libraries(${exe} ${SDL2_TTF_LIBRARIES})
    target_link_libraries(${exe} ${SDL2_IMAGE_LIBRARIES})
    target_link_libraries(${exe} ${FFMPEG_LIBRARIES})
    if(V4L2_LIBRARY)
        target_link_libraries(${exe} ${V4L2_LIBRARY})
    endif()
    if(LIB_USB)
        target_link_libraries(${exe} ${LIB_USB})
    endif()
endfunction()

function(puyoai_wii_add_test target)
    add_executable(${target}_test ${target}_test.cc)
    target_link_libraries(${target}_test gtest gtest_main)
    target_link_libraries(${target}_test puyoai_wii)
    target_link_libraries(${target}_test puyoai_capture)
    target_link_libraries(${target}_test puyoai_core_server_connector)
    target_link_libraries(${target}_test puyoai_core_server)
    target_link_libraries(${target}_test puyoai_core_rensa)
    target_link_libraries(${target}_test puyoai_core_plan)
    target_link_libraries(${target}_test puyoai_core)
    target_link_libraries(${target}_test puyoai_gui)
    target_link_libraries(${target}_test puyoai_base)
    target_link_libraries(${target}_test ${SDL2_LIBRARIES})
    target_link_libraries(${target}_test ${SDL2_TTF_LIBRARIES})
    target_link_libraries(${target}_test ${SDL2_IMAGE_LIBRARIES})
    target_link_libraries(${target}_test ${FFMPEG_LIBRARIES})
    puyoai_target_link_libraries(${target}_test)
    add_test(check-${target}_test ${target}_test)
endfunction()

puyoai_wii_add_executable(connect_wii main.cc)

puyoai_wii_add_test(wii_connect_server)
